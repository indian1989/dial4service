<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Search Results | Dial4Service</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#f4f4f4}
a{text-decoration:none;color:#333}

.header{
 background:#0a66c2;color:#fff;padding:15px;text-align:center
}

.results{
 padding:20px;
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
 gap:15px
}

.card{
 background:#fff;padding:15px;border-radius:6px;
 box-shadow:0 2px 5px rgba(0,0,0,0.1)
}

.card h3{margin:0;color:#0a66c2}
.card small{color:#777}

.rating{color:#ff9800;font-weight:bold}

.call{
 display:block;margin-top:10px;
 background:#28a745;color:#fff;
 text-align:center;padding:8px;border-radius:4px
}

.no-data{
 text-align:center;padding:40px;font-size:18px;color:#777
}
</style>
</head>

<body>

<div class="header">
 <h2 id="title">Search Results</h2>
 <div id="map" style="width:100%;height:300px;margin:10px 0;"></div>

</div>

<div class="results" id="resultBox">
 Loading businesses...
</div>

<script>
<script>
const API = "https://dial4service.onrender.com/api";

const params = new URLSearchParams(window.location.search);
const lat = params.get("lat");
const lng = params.get("lng");
const city = params.get("city");
const category = params.get("category");

let url = "";

if(lat && lng){
  url = `${API}/business/nearby?lat=${lat}&lng=${lng}`;
}else{
  url = `${API}/business/search?`;
  if(city) url += `city=${city}&`;
  if(category) url += `category=${category}&`;
}

fetch(url)
.then(res=>res.json())
.then(data=>{
  if(!data.length){
    document.getElementById("resultBox").innerHTML =
      "<p style='text-align:center'>No result found</p>";
    return;
  }

  showResults(data);

  if(lat && lng){
    loadMap(parseFloat(lat), parseFloat(lng), data);
  }
});

function showResults(data){
  let html="";
  data.forEach(b=>{
    html+=`
      <div class="card">
        <h3>${b.name}</h3>
        <p>${b.category} ‚Ä¢ ${b.city}</p>
        <p>${b.address || ""}</p>
        <strong>‚≠ê ${b.rating || "New"}</strong>
        <a href="tel:${b.phone}" class="call">üìû Call</a>
      </div>
    `;
  });
  document.getElementById("resultBox").innerHTML = html;
}

/* GOOGLE MAP */
function loadMap(lat,lng,data){
  const map = new google.maps.Map(document.getElementById("map"),{
    center:{lat:lat,lng:lng},
    zoom:13
  });

  // user location marker
  new google.maps.Marker({
    position:{lat:lat,lng:lng},
    map:map,
    icon:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
  });

  data.forEach(b=>{
    if(!b.location) return;
    new google.maps.Marker({
      position:{
        lat:b.location.coordinates[1],
        lng:b.location.coordinates[0]
      },
      map:map,
      title:b.name
    });
  });
}
</script>

 <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_KEY"></script>

</body>
</html>



