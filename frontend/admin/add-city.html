<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Add City | Admin Panel</title>
<link rel="stylesheet" href="../css/style.css">

<style>
.container { max-width: 1100px; margin: auto; }
form { background:#fff; padding:20px; border-radius:6px; }
input, select, button { padding:10px; margin:6px 0; width:100%; }
table { width:100%; border-collapse: collapse; margin-top:20px; }
table th, table td { border:1px solid #ddd; padding:10px; text-align:left; }
table th { background:#f4f4f4; }
.action-btn { margin-right:5px; cursor:pointer; }
</style>
</head>

<body>

<div class="container">

<h2>‚ûï Add City</h2>

<form id="cityForm">
  <input type="hidden" id="cityId">

  <label>City Name</label>
  <input type="text" id="cityName" placeholder="Enter city name" required>

  <label>State</label>
  <input type="text" id="stateName" placeholder="Enter state name" required>

  <label>Status</label>
  <select id="cityStatus">
    <option value="active">Active</option>
    <option value="inactive">Inactive</option>
  </select>

  <button type="submit">Save City</button>
</form>

<hr>

<h3>üìç City List</h3>

<table>
<thead>
<tr>
  <th>#</th>
  <th>City</th>
  <th>State</th>
  <th>Status</th>
  <th>Action</th>
</tr>
</thead>

<tbody id="cityTable">
<tr>
  <td>1</td>
  <td>Delhi</td>
  <td>Delhi</td>
  <td>Active</td>
  <td>
    <button class="action-btn" onclick="editCity('1','Delhi','Delhi','active')">Edit</button>
    <button class="action-btn" onclick="deleteCity('1')">Delete</button>
  </td>
</tr>
</tbody>
</table>

</div>

<script>

const API_BASE = "https://dial4service.onrender.com/api/cities";

document.addEventListener("DOMContentLoaded", loadCities);

function generateSlug(text){
  return text.toLowerCase().replace(/ /g,'-').replace(/[^\w-]+/g,'');
}

async function loadCities(){
  try{
    const res = await fetch(API_BASE);
    const data = await res.json();

    const table = document.getElementById("cityTable");
    table.innerHTML = "";

    data.data.forEach((city, index)=>{
      table.innerHTML += `
        <tr>
          <td>${index+1}</td>
          <td>${city.name}</td>
          <td>${city.isActive ? "Active" : "Inactive"}</td>
          <td>
            <button onclick="editCity('${city._id}','${city.name}','${city.isActive}')">Edit</button>
            <button onclick="deleteCity('${city._id}')">Delete</button>
          </td>
        </tr>
      `;
    });

  }catch(err){
    console.log(err);
  }
}

document.getElementById("cityForm").addEventListener("submit", async function(e){
  e.preventDefault();

  const id = document.getElementById("cityId").value;

  const cityData = {
    name: document.getElementById("cityName").value,
    isActive: document.getElementById("cityStatus").value === "active"
  };

  try{
    const res = await fetch(
      id ? API_BASE + "/" + id : API_BASE,
      {
        method: id ? "PUT" : "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + localStorage.getItem("adminToken")
        },
        body: JSON.stringify(cityData)
      }
    );

    const data = await res.json();
    alert(data.message || "Success");
    this.reset();
    loadCities();

  }catch(err){
    console.log(err);
  }
});

function editCity(id, name, isActive){
  document.getElementById("cityId").value = id;
  document.getElementById("cityName").value = name;
  document.getElementById("cityStatus").value = isActive ? "active" : "inactive";
}

async function deleteCity(id){
  if(confirm("Delete this city?")){
    await fetch(API_BASE + "/" + id,{
      method: "DELETE",
      headers:{
        "Authorization": "Bearer " + localStorage.getItem("adminToken")
      }
    });
    loadCities();
  }
}

</script><script>

const API_BASE = "https://dial4service.onrender.com/api/cities";

document.addEventListener("DOMContentLoaded", loadCities);

function generateSlug(text){
  return text.toLowerCase().replace(/ /g,'-').replace(/[^\w-]+/g,'');
}

async function loadCities(){
  try{
    const res = await fetch(API_BASE);
    const data = await res.json();

    const table = document.getElementById("cityTable");
    table.innerHTML = "";

    data.data.forEach((city, index)=>{
      table.innerHTML += `
        <tr>
          <td>${index+1}</td>
          <td>${city.name}</td>
          <td>${city.isActive ? "Active" : "Inactive"}</td>
          <td>
            <button onclick="editCity('${city._id}','${city.name}','${city.isActive}')">Edit</button>
            <button onclick="deleteCity('${city._id}')">Delete</button>
          </td>
        </tr>
      `;
    });

  }catch(err){
    console.log(err);
  }
}

document.getElementById("cityForm").addEventListener("submit", async function(e){
  e.preventDefault();

  const id = document.getElementById("cityId").value;

  const cityData = {
    name: document.getElementById("cityName").value,
    isActive: document.getElementById("cityStatus").value === "active"
  };

  try{
    const res = await fetch(
      id ? API_BASE + "/" + id : API_BASE,
      {
        method: id ? "PUT" : "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + localStorage.getItem("adminToken")
        },
        body: JSON.stringify(cityData)
      }
    );

    const data = await res.json();
    alert(data.message || "Success");
    this.reset();
    loadCities();

  }catch(err){
    console.log(err);
  }
});

function editCity(id, name, isActive){
  document.getElementById("cityId").value = id;
  document.getElementById("cityName").value = name;
  document.getElementById("cityStatus").value = isActive ? "active" : "inactive";
}

async function deleteCity(id){
  if(confirm("Delete this city?")){
    await fetch(API_BASE + "/" + id,{
      method: "DELETE",
      headers:{
        "Authorization": "Bearer " + localStorage.getItem("adminToken")
      }
    });
    loadCities();
  }
}

</script>
</body>
</html>
